(function(){"use strict";var e={2670:function(e,n,r){var a=r(9963),o=r(6252);function t(e,n){const r=(0,o.up)("router-view");return(0,o.wg)(),(0,o.j4)(r)}var l=r(3744);const s={},i=(0,l.Z)(s,[["render",t]]);var u=i,c=r(2119);const d={class:"welcome container"},p={key:0},m=(0,o.Uk)("還沒有帳號嗎? "),v={key:1},g=(0,o.Uk)("已有帳號了嗎? ");function w(e,n,r,a,t,l){const s=(0,o.up)("LoginForm"),i=(0,o.up)("SignupForm");return(0,o.wg)(),(0,o.iD)("div",d,[a.showLogin?((0,o.wg)(),(0,o.iD)("div",p,[(0,o.Wm)(s,{onLogin:a.enterChat},null,8,["onLogin"]),(0,o._)("p",null,[m,(0,o._)("span",{onClick:n[0]||(n[0]=e=>a.showLogin=!1)},"加入!")])])):(0,o.kq)("",!0),a.showLogin?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",v,[(0,o.Wm)(i,{onSignup:a.enterChat},null,8,["onSignup"]),(0,o._)("p",null,[g,(0,o._)("span",{onClick:n[1]||(n[1]=e=>a.showLogin=!0)},"立即登入")])]))])}var h=r(3577);const f=(0,o._)("h1",null,"註冊",-1),y={class:"displayName"},_=(0,o._)("label",{for:"displayName"},"帳號:",-1),b={class:"email"},k=(0,o._)("label",{for:"email"},"E-mail:",-1),S={class:"password"},C=(0,o._)("label",{for:"email"},"密碼:",-1),D={class:"error"},H=(0,o._)("button",null,"Sign up",-1);function L(e,n,r,t,l,s){return(0,o.wg)(),(0,o.iD)(o.HY,null,[f,(0,o._)("form",{onSubmit:n[3]||(n[3]=(0,a.iM)(((...e)=>t.handleSubmit&&t.handleSubmit(...e)),["prevent"]))},[(0,o._)("div",y,[_,(0,o.wy)((0,o._)("input",{type:"text",required:"","onUpdate:modelValue":n[0]||(n[0]=e=>t.displayName=e)},null,512),[[a.nr,t.displayName]])]),(0,o._)("div",b,[k,(0,o.wy)((0,o._)("input",{type:"email",required:"","onUpdate:modelValue":n[1]||(n[1]=e=>t.email=e)},null,512),[[a.nr,t.email]])]),(0,o._)("div",S,[C,(0,o.wy)((0,o._)("input",{type:"password",required:"","onUpdate:modelValue":n[2]||(n[2]=e=>t.password=e)},null,512),[[a.nr,t.password]])]),(0,o._)("div",D,(0,h.zw)(t.error),1),H],32)],64)}var W=r(2262),N=(r(1703),r(5503));r(6170),r(2211);const O={apiKey:"AIzaSyDpLViRHr0pxo7nKKqCLGWLS-Qe4YG9LXs",authDomain:"vue-cli-practice-45048.firebaseapp.com",projectId:"vue-cli-practice-45048",storageBucket:"vue-cli-practice-45048.appspot.com",messagingSenderId:"684461468919",appId:"1:684461468919:web:d4741661a98796e0f837f2",measurementId:"G-LHQDVV11CT"};N.Z.initializeApp(O);const Z=N.Z.auth(),q=N.Z.firestore(),z=N.Z.firestore.FieldValue.serverTimestamp,A=(0,W.iH)(null),E=async(e,n,r)=>{A.value=null;try{const a=await Z.createUserWithEmailAndPassword(e,n);if(!a)throw new Error("無法註冊");return console.log(a.user),await a.user.updateProfile({displayName:r}),A.value=null,a}catch(a){A.value=a.message}},U=()=>({error:A,signup:E});var V=U,I={setup(e,n){const r=(0,W.iH)(""),a=(0,W.iH)(""),o=(0,W.iH)(""),{error:t,signup:l}=V(),s=async()=>{await l(a.value,o.value,r.value),t.value||n.emit("signup")};return{displayName:r,email:a,password:o,handleSubmit:s,error:t}}};const j=(0,l.Z)(I,[["render",L]]);var F=j;const x=(0,o._)("h1",null,"登入",-1),P={class:"email"},K=(0,o._)("label",{for:"email"},"E-mail:",-1),T={class:"password"},Y=(0,o._)("label",{for:"email"},"密碼:",-1),M={class:"error"},G=(0,o._)("button",null,"Login",-1);function B(e,n,r,t,l,s){return(0,o.wg)(),(0,o.iD)(o.HY,null,[x,(0,o._)("form",{onSubmit:n[2]||(n[2]=(0,a.iM)(((...e)=>t.handleSubmit&&t.handleSubmit(...e)),["prevent"]))},[(0,o._)("div",P,[K,(0,o.wy)((0,o._)("input",{type:"email",required:"","onUpdate:modelValue":n[0]||(n[0]=e=>t.email=e)},null,512),[[a.nr,t.email]])]),(0,o._)("div",T,[Y,(0,o.wy)((0,o._)("input",{type:"password",required:"","onUpdate:modelValue":n[1]||(n[1]=e=>t.password=e)},null,512),[[a.nr,t.password]])]),(0,o._)("div",M,(0,h.zw)(t.error),1),G],32)],64)}const Q=(0,W.iH)(null),R=async(e,n)=>{Q.value=null;try{const r=await Z.signInWithEmailAndPassword(e,n);return Q.value=null,console.log(r),r}catch(r){console.log(r),Q.value="登入失敗！"}},X=()=>({error:Q,login:R});var J=X,$={setup(e,n){const r=(0,W.iH)(""),a=(0,W.iH)(""),{error:o,login:t}=J(),l=async()=>{await t(r.value,a.value),o.value||n.emit("login")};return{email:r,password:a,handleSubmit:l,error:o}}};const ee=(0,l.Z)($,[["render",B]]);var ne=ee,re={name:"Welcome",components:{SignupForm:F,LoginForm:ne},setup(){const e=(0,W.iH)(!0),n=(0,c.tv)(),r=()=>{n.push({name:"Chatroom"})};return{showLogin:e,enterChat:r}}};const ae=(0,l.Z)(re,[["render",w]]);var oe=ae;const te={class:"container"};function le(e,n,r,a,t,l){const s=(0,o.up)("Navbar"),i=(0,o.up)("ChatWindow"),u=(0,o.up)("NewChatForm");return(0,o.wg)(),(0,o.iD)("div",te,[(0,o.Wm)(s),(0,o.Wm)(i),(0,o.Wm)(u)])}const se={key:0},ie={class:"email"};function ue(e,n,r,a,t,l){return a.user?((0,o.wg)(),(0,o.iD)("nav",se,[(0,o._)("div",null,[(0,o._)("p",null,"您好！ "+(0,h.zw)(a.user.displayName)+" ！",1),(0,o._)("p",ie,"您目前登入的EMAIL為： "+(0,h.zw)(a.user.email),1)]),(0,o._)("button",{onClick:n[0]||(n[0]=(...e)=>a.handleClick&&a.handleClick(...e))},"Logout")])):(0,o.kq)("",!0)}const ce=(0,W.iH)(null),de=async()=>{ce.value=null;try{await Z.signOut()}catch(e){console.log(e.message),ce.value=e.message}},pe=()=>({error:ce,logout:de});var me=pe;const ve=(0,W.iH)(Z.currentUser);Z.onAuthStateChanged((e=>{ve.value=e}));const ge=()=>({user:ve});var we=ge,he={setup(){const{logout:e,error:n}=me(),{user:r}=we(),a=async()=>{await e()};return{handleClick:a,user:r}}};const fe=(0,l.Z)(he,[["render",ue]]);var ye=fe;const _e={class:"error"};function be(e,n,r,t,l,s){return(0,o.wg)(),(0,o.iD)("form",null,[(0,o.wy)((0,o._)("textarea",{placeholder:"按 ENTER 送出訊息","onUpdate:modelValue":n[0]||(n[0]=e=>t.message=e),onKeypress:n[1]||(n[1]=(0,a.D2)((0,a.iM)(((...e)=>t.handleSubmit&&t.handleSubmit(...e)),["prevent"]),["enter"]))},null,544),[[a.nr,t.message]]),(0,o._)("div",_e,(0,h.zw)(t.error),1)])}const ke=e=>{const n=(0,W.iH)(null),r=async r=>{n.value=null;try{await q.collection(e).add(r)}catch(a){console.log(a.message),n.value=a.message}};return{error:n,addDoc:r}};var Se=ke,Ce={setup(){const{user:e}=we(),{addDoc:n,error:r}=Se("messages"),a=(0,W.iH)(""),o=async()=>{const o={name:e.value.displayName,message:a.value,createdAt:z()};await n(o),r.value||(a.value="")};return{message:a,handleSubmit:o,error:r}}};const De=(0,l.Z)(Ce,[["render",be],["__scopeId","data-v-49d30368"]]);var He=De;const Le={class:"chat-window"},We={key:0},Ne={key:1,class:"messages"},Oe={class:"created-at"},Ze={class:"name"},qe={class:"message"};function ze(e,n,r,a,t,l){return(0,o.wg)(),(0,o.iD)("div",Le,[a.error?((0,o.wg)(),(0,o.iD)("div",We,(0,h.zw)(a.error),1)):(0,o.kq)("",!0),a.documents?((0,o.wg)(),(0,o.iD)("div",Ne,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(a.documents,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"single"},[(0,o._)("span",Oe,(0,h.zw)(e.createdAt.toDate()),1),(0,o._)("span",Ze,(0,h.zw)(e.name),1),(0,o._)("span",qe,(0,h.zw)(e.message),1)])))),128))])):(0,o.kq)("",!0)])}const Ae=e=>{const n=(0,W.iH)(null),r=(0,W.iH)(null);let a=q.collection(e).orderBy("createdAt");return a.onSnapshot((e=>{let a=[];e.docs.forEach((e=>{e.data().createdAt&&a.push({...e.data(),id:e.id})})),n.value=a,r.value=null}),(e=>{console.log(e.message),n.value=null,r.value="找不到資料"})),{error:r,documents:n}};var Ee=Ae,Ue={setup(){const{error:e,documents:n}=Ee("messages");return{error:e,documents:n}}};const Ve=(0,l.Z)(Ue,[["render",ze],["__scopeId","data-v-78f6b061"]]);var Ie=Ve,je={components:{Navbar:ye,NewChatForm:He,ChatWindow:Ie},setup(){const e=(0,c.tv)(),{user:n}=we();(0,o.YP)(n,(()=>{n.value||e.push({name:"Welcome"})}))}};const Fe=(0,l.Z)(je,[["render",le]]);var xe=Fe;const Pe=(e,n,r)=>{let a=Z.currentUser;console.log("現在登入的用戶是：",a),a?r():r({name:"Welcome"})},Ke=[{path:"/",name:"Welcome",component:oe},{path:"/chatroom",name:"Chatroom",component:xe,beforeEnter:Pe}],Te=(0,c.p7)({history:(0,c.PO)("/live-chat-room/"),routes:Ke});var Ye=Te;let Me;Z.onAuthStateChanged((()=>{Me||(Me=(0,a.ri)(u).use(Ye).mount("#app"))}))}},n={};function r(a){var o=n[a];if(void 0!==o)return o.exports;var t=n[a]={exports:{}};return e[a](t,t.exports,r),t.exports}r.m=e,function(){var e=[];r.O=function(n,a,o,t){if(!a){var l=1/0;for(c=0;c<e.length;c++){a=e[c][0],o=e[c][1],t=e[c][2];for(var s=!0,i=0;i<a.length;i++)(!1&t||l>=t)&&Object.keys(r.O).every((function(e){return r.O[e](a[i])}))?a.splice(i--,1):(s=!1,t<l&&(l=t));if(s){e.splice(c--,1);var u=o();void 0!==u&&(n=u)}}return n}t=t||0;for(var c=e.length;c>0&&e[c-1][2]>t;c--)e[c]=e[c-1];e[c]=[a,o,t]}}(),function(){r.d=function(e,n){for(var a in n)r.o(n,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:n[a]})}}(),function(){r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){r.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}}(),function(){var e={143:0};r.O.j=function(n){return 0===e[n]};var n=function(n,a){var o,t,l=a[0],s=a[1],i=a[2],u=0;if(l.some((function(n){return 0!==e[n]}))){for(o in s)r.o(s,o)&&(r.m[o]=s[o]);if(i)var c=i(r)}for(n&&n(a);u<l.length;u++)t=l[u],r.o(e,t)&&e[t]&&e[t][0](),e[t]=0;return r.O(c)},a=self["webpackChunklive_chat"]=self["webpackChunklive_chat"]||[];a.forEach(n.bind(null,0)),a.push=n.bind(null,a.push.bind(a))}();var a=r.O(void 0,[998],(function(){return r(2670)}));a=r.O(a)})();
//# sourceMappingURL=app.de95f04f.js.map